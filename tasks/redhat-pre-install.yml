---
- name: remove packages
  yum:
    name:
      - nvidia-docker
      - nvidia-docker2
    state: absent
    autoremove: yes

- name: add repo
  yum_repository:
    name: "{{ item.name }}"
    description: "{{ item.name }}"
    baseurl: "{{ item.baseurl }}"
    gpgkey: "{{ nvidia_docker_repo_gpg_url }}"
  when: nvidia_docker_add_repo
  environment: "{{proxy_env if proxy_env is defined else {}}}"
  with_items: "{{ nvidia_docker_yum_repos }}"

- name: install packages
  yum:
    name: nvidia-container-runtime
    state: present
    update_cache: yes
  notify: reload docker
  environment: "{{proxy_env if proxy_env is defined else {}}}"
